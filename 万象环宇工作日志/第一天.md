# 2024年7月25日 21:27:43
------------------------------------------------
## 目前看到的情况:
1.branch里面有dev以及dev-wu,使用哪个才是正确的开发环境?

2.数据接口在公网能访问吗?

3.有没有用cloudflare做cdn加速

4.有没有局域网测试环境 test

5.有没有灰度测试环境  gray

6.有没有正式环境  production



## 交接问题:
1.用户中心组件之间的状态管理是怎么做的？

2.用户登录的状态管理是怎么做的？

3.这个应用做了移动版吗？pc/移动版的混合适配是怎么做的？没做的话您打算怎么做？

4.我看您使用了umi,您是如何让它在ssr的工作模式下工作的? 没做的话计划未来您打算在什么时候去打开这个功能?

5.服务器是linux还是windows?

6.日常发布是怎么做的?

## 代码review发现的问题:
1.没有使用原生的nextjs。

2.没有看到pc/mobile混合适配的任何相关的代码。

3.没有看到使用redux和context做状态管理的任何的尝试(但似乎使用的是从umi暴露出来的一种叫useModel的方式,但使用方法根据文档和gpt给的建议看起来不是最佳实践)。

4.没有用原生的nextjs + webpack, 用的umi （阿里巴巴整合webpack + nextjs的一个前端框架）使得很多事情变得复杂和隐秘，也附带了更高的学习成本，nextjs封装了webpack,Umi封装了nextjs,这个框架非常重,会给配置和调试带来麻烦。

5.开发模式下发现在首页，antd的包就有2.2m，且首页似乎把很多与首页无关的组件都全部打包并载入了。首页的缓慢似乎和图片资源无关。

6.状态管理和守卫是从客户端通过手动设置和读取cookie进行的。
推荐的方式是在dev环境下（内网）打开客户端的ajax的cookie跨域设置，让服务器可以跨域向客户端写入cookie信息，服务器设置类似的credentials: true,可以向客户端跨域写入cookie信息，总之要用服务器向客户端写cookie,服务器用jwt或者session都行,然后每次进入页面需要先向服务器确认登录状态（发送ajax请求时让浏览器自己向服务器携带发送cookie而不是手动填写header发送），服务器确认过登录状态再告诉客户端用户访问是否合法。发布正式版时，服务器接口和客户端接口的域一致以后，再把客户端和服务器端相关跨域cookie的设置去掉就好了。这样一来就保证了登录状态的安全。因为从服务器端向客户端写入的cookie，除非使用了electron或者其它cs技术,那么在正常的浏览器里是无法进行篡改的，相对安全。

    xhrFields: {
        withCredentials: true,
    },

## 需要问袁总的问题：
1.从0开始做这个项目到上线，当初认为多久完成？

2.项目原本计划什么时候上线?

3.Web端做到这个程度用了多长时间?

4.首先我要承认一件事情，就是Umi这个框架我没有任何使用经验，可以说是一窍不通。这种前提下我一边学一边随着她的代码改出来可能会差不多或者更差也有可能。

5.重构整个项目您能够接受吗? 就是从头来过。

    --1.1：能接受的话您觉得花费多久能接受？

        我统筹出来的时间是一个半月左右。但有可能更短。

    --1.2: 不能接受的话，基于我调查到的问题看起来根据她的代码再进行修改项目进行下去可能达不到您的预期(也达不到我的而标准)。

        要是考虑不能放弃当前代码，需要在一个月之内把bug修复完并完成优化，这可能面临巨大的风险。


## 如果重新开始，一个半月的时间我会如此花费：
-------------------------------------------------
### 第一阶段：前期准备
第一周：根据项目情况整理一个框架出来，仅用nextjs + react 应该也会使用pixi。在内网搭建一个测试环境用方便随时访问,并建立一个文档系统做一些技术方面的记录，我每天提交的最新效果和进度都能在这上面看到。

第二周：重构首页静态页和用户中心的所有功能页面，基于设计中的黑白样式切换，会整理一套方案并出文档。

### 第二阶段：数据绑定
第三周：做用户登录和权限控制，以及为用户中心更复杂功能的状态管理和数据绑定做一些设计和计划。

第四周：做用户中心的数据绑定,上传音频等。

### 第三阶段：交互效果以及界面的运行效率优化（渲染，网络）
第五周：完成首页视觉效果的优化和加载速度的优化，完成用户中心的动效优化和加载速度优化。

第六周：完成404页面，ie不兼容页面并测试和发布。

全程我将使用git编写一些文档确保日后代码的可维护性。

一旦采取这个方案，我理解大家对于重构项目的紧迫性,所以，为项目进度考虑所有这三个阶段我会加班进行,且每天写工作日志保证进度透明可控。


